<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comentarios IreSoph</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
            color: #333;
        }
        header {
            background-color: #4a90e2;
            color: white;
            text-align: center;
            padding: 2rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        header h1 {
            margin: 0;
            font-size: 2.5rem;
        }
        .container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        .comments-section {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        .comment {
            display: flex;
            align-items: flex-start;
            padding: 1rem 0;
            border-bottom: 1px solid #eee;
            position: relative;
        }
        .comment:last-child {
            border-bottom: none;
        }
        .comment .profile-pic {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 1rem;
            align-self: flex-start;
            background-color: #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }
        .comment .comment-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 40px;
        }
        .comment .comment-content .nombre {
            font-weight: bold;
            margin: 0 0 0.3rem 0;
            color: #333;
        }
        .comment .comment-content .texto {
            margin: 0;
            color: #555;
        }
        .comment-actions {
            display: flex;
            gap: 1rem;
            margin-top: 0.5rem;
            align-items: center;
        }
        .comment-actions button {
            background: none;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.2rem 0.5rem;
            font-size: 0.9rem;
            color: #666;
        }
        .comment-actions button:hover {
            color: #333;
        }
        .menu-options {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        .menu-options button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            color: #666;
        }
        .menu-options .dropdown {
            display: none;
            position: absolute;
            right: 0;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            z-index: 1;
        }
        .menu-options .dropdown.active {
            display: block;
        }
        .menu-options .dropdown button {
            display: block;
            width: 100%;
            padding: 0.5rem 1rem;
            text-align: left;
            border: none;
            background: none;
            cursor: pointer;
            color: #333;
        }
        .menu-options .dropdown button:hover {
            background-color: #f0f0f0;
        }
        .edit-form {
            display: none;
            margin-top: 0.5rem;
        }
        .edit-form.active {
            display: flex;
            gap: 0.5rem;
        }
        .replies {
            margin-left: 3rem;
            margin-top: 0.5rem;
        }
        .reply {
            display: flex;
            align-items: flex-start;
            padding: 0.5rem 0;
            border-top: 1px solid #f0f0f0;
        }
        .reply .profile-pic {
            width: 30px;
            height: 30px;
        }
        .reply .comment-content {
            min-height: 30px;
        }
        .reply-form {
            margin-left: 3rem;
            margin-top: 0.5rem;
            display: none;
        }
        .reply-form.active {
            display: flex;
        }
        .form-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        input, button {
            padding: 0.75rem;
            font-size: 1rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            flex: 1;
            min-width: 200px;
        }
        button {
            background-color: #4a90e2;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
            flex: 0 0 auto;
        }
        button:hover {
            background-color: #357abd;
        }
        footer {
            text-align: center;
            padding: 1rem;
            background-color: #4a90e2;
            color: white;
            position: fixed;
            bottom: 0;
            width: 100%;
        }
        @media (max-width: 600px) {
            header h1 {
                font-size: 1.8rem;
            }
            header p {
                font-size: 0.9rem;
            }
            .container {
                padding: 0 0.5rem;
            }
            input {
                min-width: 100%;
            }
            button {
                width: 100%;
                padding: 0.75rem;
            }
            .form-group {
                flex-direction: column;
            }
            .comment-actions {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Comentarios IreSoph</h1>
        <p>Un lugar para comentarnos a los creadores de IreSoph</p>
    </header>

    <div class="container">
        <div class="comments-section">
            <h2>Comentarios</h2>
            <div id="comments-list"></div>
        </div>
        <div class="form-group">
            <input type="text" id="nombreInput" placeholder="Tu nombre (opcional)">
            <input type="text" id="commentInput" placeholder="Escribe tu comentario...">
            <button onclick="agregarComentario()">Enviar</button>
        </div>
    </div>

    <footer>
        <p>© 2025 Comentarios IreSoph. Todos los derechos reservados.</p>
    </footer>

    <!-- Incluir Firebase SDK (versión modular) -->
    <script type="module">
        // Importar los módulos necesarios de Firebase
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
        import { getDatabase, ref, onValue, push, update, remove } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js';

        // Configuración de Firebase (credenciales de tu proyecto IreSoph)
        const firebaseConfig = {
            apiKey: "AIzaSyBAg0MTpWqrdE--W7G9tm0cFE4YZyFtyk",
            authDomain: "iresoph-9bf6e.firebaseapp.com",
            databaseURL: "https://iresoph-9bf6e-default-rtdb.firebaseio.com",
            projectId: "iresoph-9bf6e",
            storageBucket: "iresoph-9bf6e.appspot.com",
            messagingSenderId: "9418117274235",
            appId: "1:9418117274235:web:b0d7816c9a8bc245686856",
            measurementId: "G-1FNW6MLW"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Generar o recuperar el userId del usuario actual
        let currentUserId = localStorage.getItem('currentUserId');
        if (!currentUserId) {
            currentUserId = 'user_' + Date.now();
            localStorage.setItem('currentUserId', currentUserId);
        }

        // Generar color aleatorio basado en un string (nombre o timestamp)
        function generarColorAleatorio(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                hash = str.charCodeAt(i) + ((hash << 5) - hash);
            }
            const r = (hash & 0xff0000) >> 16;
            const g = (hash & 0x00ff00) >> 8;
            const b = hash & 0x0000ff;
            return `rgb(${r}, ${g}, ${b})`;
        }

        // Cargar comentarios desde Firebase
        function cargarComentarios() {
            const commentsList = document.getElementById('comments-list');
            const comentariosRef = ref(database, 'comentarios');
            onValue(comentariosRef, (snapshot) => {
                commentsList.innerHTML = ''; // Limpiar la lista
                const comentarios = snapshot.val();
                if (comentarios) {
                    Object.entries(comentarios).forEach(([id, comentario]) => {
                        const color = generarColorAleatorio(comentario.nombre || comentario.timestamp);
                        const userId = comentario.userId || 'anonymous_' + id;
                        const isAuthor = userId === currentUserId; // Verificar si el usuario es el autor
                        const div = document.createElement('div');
                        div.className = 'comment';
                        div.setAttribute('data-id', id);
                        div.setAttribute('data-user-id', userId);
                        div.innerHTML = `
                            <div class="profile-pic" style="background-color: ${color};">${(comentario.nombre || 'Anónimo')[0]}</div>
                            <div class="comment-content">
                                <p class="nombre">${comentario.nombre || 'Anónimo'}</p>
                                <p class="texto">${comentario.texto}</p>
                                <div class="comment-actions">
                                    <button onclick="darLike('${id}', '${userId}')">
                                        👍 ${comentario.likes || 0}
                                    </button>
                                    <button onclick="darDislike('${id}', '${userId}')">
                                        👎 ${comentario.dislikes || 0}
                                    </button>
                                    <button onclick="mostrarResponder('${id}')">Responder</button>
                                </div>
                                <div class="replies" id="replies-${id}"></div>
                                <div class="reply-form" id="reply-form-${id}">
                                    <input type="text" id="reply-nombre-${id}" placeholder="Tu nombre (opcional)">
                                    <input type="text" id="reply-texto-${id}" placeholder="Escribe tu respuesta...">
                                    <button onclick="agregarRespuesta('${id}')">Enviar</button>
                                </div>
                                <div class="edit-form" id="edit-form-${id}">
                                    <input type="text" id="edit-texto-${id}" value="${comentario.texto}">
                                    <button onclick="guardarEdicion('${id}')">Guardar</button>
                                    <button onclick="cancelarEdicion('${id}')">Cancelar</button>
                                    </div>
                            </div>
                            <div class="menu-options">
                                <button onclick="mostrarMenu('${id}')">⋮</button>
                                <div class="dropdown" id="dropdown-${id}">
                                    ${isAuthor ? `<button onclick="eliminarComentario('${id}', '${userId}')">Eliminar</button>` : ''}
                                    <button onclick="compartirComentario('${id}')">Compartir</button>
                                    <button onclick="editarComentario('${id}', '${userId}')">Editar</button>
                                </div>
                            </div>
                        `;
                        commentsList.appendChild(div);

                        // Cargar respuestas si existen
                        if (comentario.replies) {
                            const repliesDiv = document.getElementById(`replies-${id}`);
                            Object.values(comentario.replies).forEach(reply => {
                                const replyColor = generarColorAleatorio(reply.nombre || reply.timestamp);
                                const replyDiv = document.createElement('div');
                                replyDiv.className = 'reply';
                                replyDiv.innerHTML = `
                                    <div class="profile-pic" style="background-color: ${replyColor};">${(reply.nombre || 'Anónimo')[0]}</div>
                                    <div class="comment-content">
                                        <p class="nombre">${reply.nombre || 'Anónimo'}</p>
                                        <p class="texto">${reply.texto}</p>
                                    </div>
                                `;
                                repliesDiv.appendChild(replyDiv);
                            });
                        }
                    });
                }
            });
        }

        // Agregar un nuevo comentario a Firebase
        function agregarComentario() {
            const nombre = document.getElementById('nombreInput').value || 'Anónimo';
            const texto = document.getElementById('commentInput').value;
            if (texto.trim()) {
                const nuevoComentario = {
                    nombre: nombre,
                    texto: texto,
                    timestamp: new Date().toISOString(),
                    likes: 0,
                    dislikes: 0,
                    userId: currentUserId
                };
                // Guardar en Firebase
                push(ref(database, 'comentarios'), nuevoComentario);
                // Limpiar el formulario
                document.getElementById('nombreInput').value = '';
                document.getElementById('commentInput').value = '';
            }
        }

        // Dar like a un comentario
        function darLike(id, userId) {
            const voteKey = `vote_${id}_${userId}`;
            const currentVote = localStorage.getItem(voteKey);
            const comentarioRef = ref(database, `comentarios/${id}`);

            onValue(comentarioRef, (snapshot) => {
                const comentario = snapshot.val();
                let updates = {};

                if (currentVote === 'like') {
                    // Si ya dio like, quitarlo
                    updates.likes = (comentario.likes || 0) - 1;
                    localStorage.removeItem(voteKey);
                } else {
                    // Si no ha votado o dio dislike, agregar like
                    updates.likes = (comentario.likes || 0) + 1;
                    if (currentVote === 'dislike') {
                        updates.dislikes = (comentario.dislikes || 0) - 1;
                    }
                    localStorage.setItem(voteKey, 'like');
                }

                update(comentarioRef, updates);
            }, { onlyOnce: true });
        }

        // Dar dislike a un comentario
        function darDislike(id, userId) {
            const voteKey = `vote_${id}_${userId}`;
            const currentVote = localStorage.getItem(voteKey);
            const comentarioRef = ref(database, `comentarios/${id}`);

            onValue(comentarioRef, (snapshot) => {
                const comentario = snapshot.val();
                let updates = {};

                if (currentVote === 'dislike') {
                    // Si ya dio dislike, quitarlo
                    updates.dislikes = (comentario.dislikes || 0) - 1;
                    localStorage.removeItem(voteKey);
                } else {
                    // Si no ha votado o dio like, agregar dislike
                    updates.dislikes = (comentario.dislikes || 0) + 1;
                    if (currentVote === 'like') {
                        updates.likes = (comentario.likes || 0) - 1;
                    }
                    localStorage.setItem(voteKey, 'dislike');
                }

                update(comentarioRef, updates);
            }, { onlyOnce: true });
        }

        // Mostrar el formulario de respuesta
        function mostrarResponder(id) {
            const replyForm = document.getElementById(`reply-form-${id}`);
            replyForm.classList.toggle('active');
        }

        // Agregar una respuesta a un comentario
        function agregarRespuesta(id) {
            const nombre = document.getElementById(`reply-nombre-${id}`).value || 'Anónimo';
            const texto = document.getElementById(`reply-texto-${id}`).value;
            if (texto.trim()) {
                const nuevaRespuesta = {
                    nombre: nombre,
                    texto: texto,
                    timestamp: new Date().toISOString()
                };
                // Guardar la respuesta en Firebase
                push(ref(database, `comentarios/${id}/replies`), nuevaRespuesta);
                // Limpiar el formulario de respuesta
                document.getElementById(`reply-nombre-${id}`).value = '';
                document.getElementById(`reply-texto-${id}`).value = '';
                document.getElementById(`reply-form-${id}`).classList.remove('active');
            }
        }

        // Mostrar el menú de opciones
        function mostrarMenu(id) {
            const dropdown = document.getElementById(`dropdown-${id}`);
            dropdown.classList.toggle('active');
        }

        // Eliminar un comentario
        function eliminarComentario(id, userId) {
            if (userId !== currentUserId) {
                alert('No tienes permiso para eliminar este comentario.');
                return;
            }
            const comentarioRef = ref(database, `comentarios/${id}`);
            remove(comentarioRef);
        }

        // Compartir un comentario
        function compartirComentario(id) {
            const url = `${window.location.href}#comment-${id}`;
            navigator.clipboard.writeText(url).then(() => {
                alert('Enlace al comentario copiado al portapapeles: ' + url);
            });
        }

        // Editar un comentario
        function editarComentario(id, userId) {
            if (userId !== currentUserId) {
                alert('No tienes permiso para editar este comentario.');
                return;
            }
            const editForm = document.getElementById(`edit-form-${id}`);
            editForm.classList.add('active');
            const dropdown = document.getElementById(`dropdown-${id}`);
            dropdown.classList.remove('active');
        }

        // Guardar la edición del comentario
        function guardarEdicion(id) {
            const texto = document.getElementById(`edit-texto-${id}`).value;
            if (texto.trim()) {
                const comentarioRef = ref(database, `comentarios/${id}`);
                update(comentarioRef, { texto: texto });
                document.getElementById(`edit-form-${id}`).classList.remove('active');
            }
        }

        // Cancelar la edición
        function cancelarEdicion(id) {
            document.getElementById(`edit-form-${id}`).classList.remove('active');
        }

        // Cargar comentarios al iniciar la página
        window.onload = cargarComentarios;

        // Hacer las funciones accesibles globalmente
        window.agregarComentario = agregarComentario;
        window.darLike = darLike;
        window.darDislike = darDislike;
        window.mostrarResponder = mostrarResponder;
        window.agregarRespuesta = agregarRespuesta;
        window.mostrarMenu = mostrarMenu;
        window.eliminarComentario = eliminarComentario;
        window.compartirComentario = compartirComentario;
        window.editarComentario = editarComentario;
        window.guardarEdicion = guardarEdicion;
        window.cancelarEdicion = cancelarEdicion;
    </script>
</body>
</html>